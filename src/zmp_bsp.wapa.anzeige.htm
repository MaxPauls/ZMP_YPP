<%@page language="abap" %>                                                                                                                                                                                                                                     
<%@extension name="htmlb" prefix="htmlb" %>                                                                                                                                                                                                                    
<html>                                                                                                                                                                                                                                                         
<head>                                                                                                                                                                                                                                                         
<title>Strandkorb AG - Aktuelle Reiseangebote</title>                                                                                                                                                                                                          
</head>                                                                                                                                                                                                                                                        
<body>                                                                                                                                                                                                                                                         
<%                                                                                                                                                                                                                                                             
  DATA: gs_wa TYPE ZMP_T_PROSP,                                                                                                                                                                                                                                
  gt_prospekte TYPE TABLE OF ZMP_T_PROSP,                                                                                                                                                                                                                      
  gs_view TYPE ZMP_PROSPVIEW,                                                                                                                                                                                                                                  
  gt_view TYPE TABLE OF ZMP_PROSPVIEW,                                                                                                                                                                                                                         
  gs_hinflug TYPE SPFLI,                                                                                                                                                                                                                                       
  gs_rueckflug TYPE SPFLI.                                                                                                                                                                                                                                     
  SELECT * FROM ZMP_T_PROSP INTO TABLE gt_prospekte.                                                                                                                                                                                                           
  LOOP AT gt_prospekte into gs_wa.                                                                                                                                                                                                                             
%>                                                                                                                                                                                                                                                             
<h1><%= gs_wa-titel %></h1>                                                                                                                                                                                                                                    
(Gültig von <%= gs_wa-von %> bis <%= gs_wa-bis%>) <br><br>                                                                                                                                                                                                     
<%                                                                                                                                                                                                                                                             
IF sy-datum > gs_wa-bis.                                                                                                                                                                                                                                       
%>                                                                                                                                                                                                                                                             
<h3> PROSPEKT IST ABGELAUFEN!!!!! </h3>                                                                                                                                                                                                                        
<%                                                                                                                                                                                                                                                             
ENDIF.                                                                                                                                                                                                                                                         
  SELECT * FROM ZMP_PROSPVIEW INTO TABLE gt_view where prospid = gs_wa-prospid.                                                                                                                                                                                
  LOOP AT gt_view into gs_view.                                                                                                                                                                                                                                
  SELECT SINGLE * FROM SPFLI INTO gs_hinflug where carrid = gs_view-carrid1 AND connid = gs_view-connid1.                                                                                                                                                      
  SELECT SINGLE * FROM SPFLI INTO gs_rueckflug where carrid = gs_view-carrid2 AND connid = gs_view-connid2.                                                                                                                                                    
  %>                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
  <h2><%=gs_view-titel2%></h2>                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
  <table border=1>                                                                                                                                                                                                                                             
  <tr><td>Angebotsnummer:                                                                                                                                                                                                                                      
</td><td><%= gs_view-angebotsid %></td></tr>                                                                                                                                                                                                                   
<tr><td>Beschreibung:</td><td><%= gs_view-beschreibung %></td></tr>                                                                                                                                                                                            
<tr><td>Preis:</td><td><%= gs_view-preis %></td></tr>                                                                                                                                                                                                          
<tr><td>Übernachtungen:</td><td><%= gs_view-naechte %></td></tr>                                                                                                                                                                                               
<tr><td>Hotel:</td><td><%= gs_view-hotel %></td></tr>                                                                                                                                                                                                          
<tr><td> Hinflug:  </td><td>Nr. <%=gs_view-carrid1%>-<%=gs_view-connid1 %> von <%=gs_hinflug-cityfrom%> nach <%=gs_hinflug-cityto%></td></tr>                                                                                                                  
<tr><td>Rückflug:</td><td>Nr. <%=gs_view-carrid2%>-<%=gs_view-connid2 %> von <%=gs_rueckflug-cityfrom%> nach <%=gs_rueckflug-cityto%></td></tr>                                                                                                                
</table>                                                                                                                                                                                                                                                       
<%                                                                                                                                                                                                                                                             
  DATA verfuegbar TYPE i.                                                                                                                                                                                                                                      
  CALL FUNCTION 'Z_ZPM_SANGEBOT'                                                                                                                                                                                                                               
  EXPORTING                                                                                                                                                                                                                                                    
  i_CARRID1 = gs_view-carrid1                                                                                                                                                                                                                                  
  i_connid1 = gs_view-connid1                                                                                                                                                                                                                                  
  i_carrid2 = gs_view-carrid2                                                                                                                                                                                                                                  
  i_connid2 = gs_view-connid2                                                                                                                                                                                                                                  
  IMPORTING                                                                                                                                                                                                                                                    
  e_verfuegbar = verfuegbar.                                                                                                                                                                                                                                   
  if verfuegbar = 1.                                                                                                                                                                                                                                           
  %> Es sind noch Flüge Verfügbar <br> <%                                                                                                                                                                                                                      
  else.                                                                                                                                                                                                                                                        
  %> Es sind derzeit keine Flüge verfügbar <br> <%                                                                                                                                                                                                             
  endif.                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
  endloop.                                                                                                                                                                                                                                                     
  endloop.                                                                                                                                                                                                                                                     
%>                                                                                                                                                                                                                                                             
</body>                                                                                                                                                                                                                                                        
</html>                                                                                                                                                                                                                                                        